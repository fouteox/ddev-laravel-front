# Details about the install.yaml file are at https://ddev.readthedocs.io/en/stable/users/extend/additional-services/#sections-and-features-of-ddev-get-add-on-installyaml

name: laravel-front

# list of files and directories listed that are copied into project .ddev directory
# Each file should contain #ddev-generated so it can be replaced by a later `ddev add-on get`
# if it hasn't been modified by the user.
# DDEV environment variables can be interpolated into these filenames
# If you use directories, they must be directories that are managed
# by this add-on, or removal could remove things that are not owned by it
project_files:
  - docker-compose.node.yaml
  - node/

post_install_actions:
  - |
    if [ -f ".env.node" ]; then
      PACKAGE_MANAGER=$(grep "^PACKAGE_MANAGER=" ".env.node" | cut -d '=' -f2 | tr -d '"' | tr -d "'")
      if [ "$PACKAGE_MANAGER" = "bun" ]; then
        sed -i 's/node:22-slim/oven\/bun:1-slim/' node/Dockerfile
        sed -i 's/node/bun/g' node/Dockerfile
    
        sed -i 's/npm run dev/bun --bun run dev/' node/docker-entrypoint.sh
      fi
    fi
